# PowerPoint Export with AI Executive Summary

## Overview

The PowerPoint export feature now includes an AI-generated executive summary as the first slide when available.

## User Experience

### Workflow

1. **Fill out fee benchmarking form** with plan details
2. **View benchmark results** page
3. **Click "Generate Summary"** in the AI Executive Summary card
4. **Wait 3-5 seconds** for AI analysis to complete
5. **Review summary** on screen
6. **Click "Export to PowerPoint"** button
7. **Download PPTX file** with executive summary as first slide

### Behavior

- **Without AI Summary**: PowerPoint contains only chart slides (existing behavior)
- **With AI Summary**: PowerPoint includes executive summary as Slide 1, followed by charts
- **Regeneration**: If summary is regenerated, the updated version is used in next export
- **Session Persistence**: Summary persists for the current session until page reload

## PowerPoint Slide Design

### Executive Summary Slide

**Layout:**
```
┌─────────────────────────────────────────┐
│ Executive Summary                       │  ← 32pt bold, dark blue
│                                         │
│ [Paragraph 1 of AI-generated summary]   │  ← 12pt, gray
│                                         │
│ [Paragraph 2 of AI-generated summary]   │
│                                         │
│ [Paragraph 3 of AI-generated summary]   │
│                                         │
│ [Paragraph 4 of AI-generated summary]   │
│                                         │
│                                         │
│ Generated by AI-powered analysis        │  ← 9pt italic, gray
│ Data Source: NEPC Defined Contribution │  ← 10pt italic, gray
│ Plan & Fee Survey                       │
└─────────────────────────────────────────┘
```

**Formatting:**
- Title: 32pt, bold, color #003B5C
- Body: 12pt, regular, color #333333
- Attribution: 9pt, italic, color #666666
- Disclaimer: 10pt, italic, color #666666
- Paragraph spacing: 0.15 inches between paragraphs
- Margins: 0.5 inches on all sides

**Text Processing:**
- Markdown bold markers (`**text**`) are automatically removed
- Text is split into paragraphs on double newlines
- Dynamic height calculation based on content length

## Technical Implementation

### Code Changes

**1. ExportOptions Interface** (`lib/exportToPowerPoint.ts`)
```typescript
interface ExportOptions {
  // ... existing properties
  aiSummary?: string;  // NEW: optional AI summary text
}
```

**2. Executive Summary Slide Generation**
```typescript
if (aiSummary) {
  const summarySlide = pptx.addSlide();
  // Format and add title
  // Split summary into paragraphs
  // Add each paragraph with proper spacing
  // Add attribution and disclaimer
}
```

**3. Component Integration** (`components/ExecutiveSummary.tsx`)
```typescript
interface ExecutiveSummaryProps {
  summaryRequest: AISummaryRequest;
  autoGenerate?: boolean;
  onSummaryGenerated?: (summary: string) => void;  // NEW: callback
}
```

**4. Parent Component State** (`components/BenchmarkResults.tsx`)
```typescript
const [aiSummary, setAiSummary] = useState<string | undefined>(undefined);

const handleSummaryGenerated = (summary: string) => {
  setAiSummary(summary);
};

// Pass to export function
await exportToPowerPoint({
  // ... existing options
  aiSummary: aiSummary,
});
```

### Data Flow

```
User clicks "Generate Summary"
    ↓
ExecutiveSummary component calls /api/ai-summary
    ↓
Azure OpenAI generates summary text
    ↓
ExecutiveSummary calls onSummaryGenerated(summary)
    ↓
BenchmarkResults stores summary in state
    ↓
User clicks "Export to PowerPoint"
    ↓
exportToPowerPoint() receives aiSummary parameter
    ↓
If aiSummary exists, creates executive summary slide
    ↓
Adds remaining chart slides
    ↓
Exports PPTX file with all slides
```

## Example Output

### Sample Executive Summary Slide Content

> **Executive Summary**
>
> This retirement plan with $5,000,000 in assets serving 150 participants demonstrates strong overall fee competitiveness relative to industry benchmarks. The total plan fee of 0.85% positions below the market median, indicating favorable pricing for participants.
>
> The advisor fee at 0.50% and record keeper fee at 0.25% both fall between the 25th and 50th percentiles, representing very good value. However, the TPA fee at 0.08% sits above the 75th percentile, suggesting this component may warrant closer scrutiny.
>
> The investment menu fee at 0.02% demonstrates exceptional value, well below the 25th percentile. This competitive pricing across core services positions the plan favorably for participant outcomes and fiduciary defensibility.
>
> Recommended actions include: (1) Conduct a TPA fee negotiation or competitive RFP process to address the above-market component, (2) Document this benchmarking analysis to demonstrate ongoing fiduciary oversight, and (3) Maintain current advisor and recordkeeper relationships given their strong value positioning.
>
> *Generated by AI-powered analysis*
> *Data Source: NEPC Defined Contribution Plan & Fee Survey*

## Benefits

### For Advisors

1. **Professional Reports**: Client-ready PowerPoint decks with executive summary
2. **Time Savings**: No manual summary writing required
3. **Consistency**: Standardized analysis format across all clients
4. **Credibility**: AI-powered insights add analytical depth
5. **Customization**: Can regenerate summary for different perspectives

### For Clients

1. **Clarity**: Executive summary provides high-level overview before details
2. **Actionability**: Specific recommendations highlighted
3. **Context**: Market positioning clearly explained
4. **Documentation**: Summary serves as fiduciary documentation
5. **Accessibility**: Plain language explanations of complex data

## Configuration

### Azure OpenAI Setup

The executive summary feature requires Azure OpenAI configuration:

```bash
# .env.local
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_DEPLOYMENT=your-deployment-name
AZURE_OPENAI_API_VERSION=2024-02-15-preview
```

**Without Azure OpenAI:**
- Executive summary card shows "Generate Summary" button
- Clicking shows error message about missing configuration
- PowerPoint export works normally without executive summary slide

**With Azure OpenAI:**
- Summary generates successfully
- PowerPoint includes executive summary as first slide
- Full AI analysis available in both UI and export

## Testing

### Test Scenarios

1. **Export without generating summary**
   - Expected: PowerPoint has chart slides only (no executive summary)
   - Verify: Slide count matches chart count

2. **Generate summary then export**
   - Expected: PowerPoint has executive summary as Slide 1, then charts
   - Verify: Summary text matches what's displayed in UI

3. **Regenerate summary then export**
   - Expected: PowerPoint uses the most recent summary
   - Verify: New content appears in PowerPoint

4. **Export with long summary**
   - Expected: Text wraps properly, fits within slide bounds
   - Verify: No text overflow or truncation

5. **Export with special characters**
   - Expected: Bold markdown removed, special chars preserved
   - Verify: Clean text formatting in PowerPoint

### Manual Testing Steps

```bash
# 1. Start development server
npm run dev

# 2. Navigate to http://localhost:3000

# 3. Fill out fee benchmarking form
#    - Enter plan details (AUM, participants)
#    - Configure fee structures
#    - Submit form

# 4. On results page, click "Generate Summary"
#    - Wait for AI generation
#    - Review summary text

# 5. Click "Export to PowerPoint"
#    - Download PPTX file
#    - Open in PowerPoint/Keynote
#    - Verify executive summary is Slide 1
#    - Verify text formatting is clean
#    - Verify all chart slides follow

# 6. Click "Regenerate" on summary
#    - Wait for new summary
#    - Export again
#    - Verify updated content in new PPTX
```

## Troubleshooting

### Issue: Executive summary slide not appearing in PowerPoint

**Possible Causes:**
1. Summary was not generated before export
2. Azure OpenAI credentials not configured
3. Summary generation failed silently

**Solutions:**
1. Ensure "Generate Summary" was clicked and completed successfully
2. Check browser console for error messages
3. Verify Azure OpenAI environment variables in `.env.local`
4. Check that summary text appears in UI before exporting

### Issue: Formatting looks wrong in PowerPoint

**Possible Causes:**
1. Very long summary causing overflow
2. Special characters not rendering correctly
3. Paragraph breaks not preserved

**Solutions:**
1. Check summary length (should be 3-5 paragraphs)
2. Regenerate summary if needed
3. Review `lib/exportToPowerPoint.ts` text processing logic
4. Test with different PowerPoint/Keynote versions

### Issue: Summary in PowerPoint different from UI

**Possible Causes:**
1. Summary was regenerated but not reflected in state
2. Callback not firing properly
3. Stale state in component

**Solutions:**
1. Regenerate summary and immediately export
2. Check browser console for state update logs
3. Refresh page and generate new summary

## Future Enhancements

1. **Custom Slide Position**: Allow user to choose where summary appears
2. **Formatting Options**: Bold/italic support in PowerPoint text
3. **Multi-Page Summaries**: Split long summaries across multiple slides
4. **Branded Templates**: Custom PowerPoint templates per organization
5. **Summary Styles**: Different summary formats (executive, technical, client-facing)
6. **Chart Integration**: Add relevant charts/metrics to summary slide
7. **Version History**: Track and export multiple summary versions
8. **PDF Export**: Generate PDF reports with summary included

## Files Modified

- `lib/exportToPowerPoint.ts` - Added executive summary slide generation
- `components/ExecutiveSummary.tsx` - Added onSummaryGenerated callback
- `components/BenchmarkResults.tsx` - State management for AI summary
- `CLAUDE.md` - Updated documentation
- `AI_SUMMARY_IMPLEMENTATION.md` - Added PowerPoint export section
- `POWERPOINT_EXPORT_SUMMARY.md` - This file (new)
